"""ëª©í‘œ ì„¹ì…˜ - ë‹¤ìŒ ì—°ë„ ì¶”ì²œ ëª©í‘œ ë° ì•¡ì…˜ ì•„ì´í…œ."""

from __future__ import annotations

from typing import Any, List

from ...game_elements import GameRenderer


def generate_goals_section(
    repository_analyses: List[Any], year: int
) -> List[str]:
    """ë‹¤ìŒ ì—°ë„ ëª©í‘œ ìƒì„± (HTML ë²„ì „)."""
    lines = [
        f"## ğŸ¯ {year + 1}ë…„ í€˜ìŠ¤íŠ¸ ëª©í‘œ",
        "",
        f"> {year}ë…„ì˜ ê²½í—˜ì„ ë°”íƒ•ìœ¼ë¡œ í•œ ë‹¤ìŒ ì‹œì¦Œ ì¶”ì²œ í€˜ìŠ¤íŠ¸",
        "",
    ]

    # Collect all improvement suggestions
    all_suggestions = []
    for repo in repository_analyses:
        for improvement in repo.improvements:
            suggestions = improvement.get("suggestions", [])
            all_suggestions.extend(suggestions)

    # Deduplicate and limit
    unique_suggestions = list(dict.fromkeys(all_suggestions))[:5]

    if unique_suggestions:
        lines.append("### ğŸ’¡ ì¶”ì²œ ì„±ì¥ ë°©í–¥")
        lines.append("")

        # Build suggestion cards
        suggestion_content = ""
        for idx, suggestion in enumerate(unique_suggestions, 1):
            suggestion_content += f"{idx}. ğŸ¯ {suggestion}\n"

        # Render as info box
        lines.extend(GameRenderer.render_info_box(
            title="ë‹¤ìŒ ë ˆë²¨ë¡œ ì˜¬ë¼ê°€ê¸° ìœ„í•œ í•µì‹¬ í¬ì»¤ìŠ¤",
            content=suggestion_content.strip(),
            emoji="ğŸ’¡",
            bg_color="#f0fdf4",
            border_color="#10b981"
        ))

    lines.append("### ğŸš€ ì‹¤í–‰ ì•¡ì…˜ ì•„ì´í…œ")
    lines.append("")

    # Build action items as HTML checklist
    action_items = [
        "ğŸ“– ê° ì €ì¥ì†Œì˜ ìƒì„¸ í”¼ë“œë°± ê²€í† í•˜ê¸°",
        "ğŸ¯ ì£¼ìš” ê°œì„  ì˜ì—­ì— ëŒ€í•œ êµ¬ì²´ì ì´ê³  ì¸¡ì • ê°€ëŠ¥í•œ ëª©í‘œ ì„¤ì •",
        "ğŸ”§ ìƒˆë¡œìš´ ê¸°ìˆ  íƒí—˜ ë˜ëŠ” í˜„ì¬ ìŠ¤íƒì˜ ì „ë¬¸ì„± ì‹¬í™”",
        "ğŸ¤ í˜‘ì—… ë° ì½”ë“œ ë¦¬ë·° ì°¸ì—¬ í™•ëŒ€",
        f"ğŸ“Š {year + 1}ë…„ ë‚´ë‚´ ë¶„ê¸°ë³„ ì§„í–‰ ìƒí™© ì¶”ì "
    ]

    lines.append('<div style="border: 2px solid #e2e8f0; border-radius: 8px; padding: 20px; margin: 16px 0; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">')
    lines.append('  <h4 style="margin: 0 0 16px 0; color: #2d3748; font-size: 1.2em;">ìƒˆë¡œìš´ ì‹œì¦Œì„ ì¤€ë¹„í•˜ëŠ” ì²´í¬ë¦¬ìŠ¤íŠ¸</h4>')
    lines.append('  <div style="display: flex; flex-direction: column; gap: 12px;">')

    for item in action_items:
        lines.append('    <label style="display: flex; align-items: center; cursor: pointer; padding: 12px; background: #f7fafc; border-radius: 6px; transition: background 0.2s;">')
        lines.append('      <input type="checkbox" style="margin-right: 12px; width: 18px; height: 18px; cursor: pointer;">')
        lines.append(f'      <span style="color: #2d3748; font-size: 1em;">{item}</span>')
        lines.append('    </label>')

    lines.append('  </div>')
    lines.append('</div>')
    lines.append("")

    lines.append("---")
    lines.append("")
    return lines


def generate_footer() -> List[str]:
    """ê²Œì„ ìŠ¤íƒ€ì¼ í‘¸í„° ìƒì„± (HTML ë²„ì „)."""
    return [
        "## ğŸ‰ ëª¨í—˜ì˜ ë§ˆë¬´ë¦¬",
        "",
        '<div style="border: 3px solid #fbbf24; border-radius: 12px; padding: 30px; margin: 20px 0; background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); text-align: center; box-shadow: 0 4px 6px rgba(251, 191, 36, 0.3);">',
        '  <div style="font-size: 2em; margin-bottom: 20px;">ğŸŒŸ</div>',
        '  <h2 style="margin: 0 0 20px 0; color: #78350f; font-size: 1.8em;">ì¶•í•˜í•©ë‹ˆë‹¤, ìš©ê°í•œ ê°œë°œìì—¬!</h2>',
        '  <p style="margin: 0 0 20px 0; color: #92400e; font-size: 1.1em; line-height: 1.6;">',
        '    ëª¨ë“  ì»¤ë°‹, PR, ë¦¬ë·°ê°€ ë‹¹ì‹ ì˜ ì„±ì¥ì— ê¸°ì—¬í–ˆìŠµë‹ˆë‹¤.<br>',
        '    ì´ ë³´ê³ ì„œë¡œ ì„±ê³¼ë¥¼ ì¶•í•˜í•˜ê³  ì§€ì†ì ì¸ ì„±ì¥ì„ ê³„íší•˜ì„¸ìš”.',
        '  </p>',
        '  <div style="background: rgba(255,255,255,0.5); border-radius: 8px; padding: 16px; margin: 20px 0;">',
        '    <div style="font-size: 1.2em; color: #78350f; font-weight: bold; margin-bottom: 8px;">ğŸ’¡ ê¸°ì–µí•˜ì„¸ìš”</div>',
        '    <div style="font-size: 1.1em; color: #92400e; font-style: italic;">"ì™„ë²½í•œ í•œ ë²ˆë³´ë‹¤ ê¾¸ì¤€í•œ ì§„ë³´ê°€ ë” ê°•í•©ë‹ˆë‹¤!"</div>',
        '  </div>',
        '  <div style="font-size: 1.5em; margin-top: 20px; color: #78350f; font-weight: bold;">ğŸš€ ê³„ì† ì „ì§„í•˜ì„¸ìš”! ğŸš€</div>',
        '</div>',
        "",
        "---",
        "",
        '<div style="text-align: center; margin: 20px 0; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; color: white;">',
        '  <div style="font-size: 1.2em; margin-bottom: 8px;">âš”ï¸ Generated by GitHub Feedback Analysis Tool âš”ï¸</div>',
        '  <div style="font-style: italic; opacity: 0.9;">ë‹¹ì‹ ì˜ ì½”ë”© ì—¬ì •ì„ ì‘ì›í•©ë‹ˆë‹¤!</div>',
        '</div>',
        "",
    ]


__all__ = ["generate_goals_section", "generate_footer"]
